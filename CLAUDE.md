# CLAUDE.md

This file provides guidance to Claude Code (claude.ai/code) when working with code in this repository.

## Overview

Claude Analyzer is a multi-platform automation tool that iteratively analyzes software modules using Claude CLI. It supports parallel processing, markdown validation, and DOCX conversion.

## Commands

### Configuration Setup
```bash
# Initialize Claude skills/agents from bundled ZIP
./bash/config.sh init

# Force overwrite existing configuration
./bash/config.sh init --force

# Verify installation
./bash/config.sh verify
```

### Running Analysis
```bash
# Full analysis workflow (analyze -> validate -> convert)
./bash/analyze.sh

# Parallel processing (up to 8 jobs)
./bash/analyze.sh --parallel 4

# Analyze specific module
./bash/analyze.sh --module Employee
./bash/analyze.sh --module Employee/Profile

# Preview without executing
./bash/analyze.sh --dry-run

# Reset all progress
./bash/analyze.sh --reset

# Retry failed modules
./bash/analyze.sh --retry-failed
```

### Phase Control
```bash
# Run only validation phase
./bash/analyze.sh --validation-only

# Run only DOCX conversion
./bash/analyze.sh --conversion-only

# Skip phases
./bash/analyze.sh --skip-validation
./bash/analyze.sh --skip-conversion
```

### PowerShell (Windows)
```powershell
.\powershell\analyze.ps1 --parallel 4
.\powershell\config.ps1 init
```

## Architecture

### Platform Structure
The tool has parallel implementations for Bash (Linux/macOS) and PowerShell (Windows). Both share identical functionality:

```
bash/           # Bash implementation
powershell/     # PowerShell implementation
```

### Library Modules (bash/lib/ and powershell/lib/)

| Module | Purpose |
|--------|---------|
| `config` | Configuration variables, timeouts, paths |
| `logging` | Colored console output, log file handling |
| `prerequisites` | Checks for claude CLI, jq, pandoc |
| `json-utils` | Module structure parsing, state tracking |
| `analysis` | Core analysis: runs `claude --dangerously-skip-permissions` with skill invocation |
| `parallel` | GNU parallel/PowerShell job management |
| `validation` | Markdown fixing for pandoc compatibility |
| `conversion` | Pandoc DOCX generation with reference doc |
| `cli` | Argument parsing, help display |

### Key Files
- `module-structure.json` - Defines modules to analyze (generated by `/module-discovery` skill)
- `.claude-config.zip` - Bundled Claude skills, agents, and settings
- `custom-reference.docx` - DOCX template for pandoc conversion
- `.analyze-state/` - Progress tracking (queue, failed modules, logs)

### Analysis Flow
1. **Phase 1 & 2**: Module analysis via Claude CLI (submodules first, then parents)
2. **Phase 3**: Markdown validation and auto-fixing
3. **Phase 4**: DOCX conversion via pandoc

### Claude Integration
The analyzer invokes Claude CLI with the `/analyze` skill:
```bash
claude --dangerously-skip-permissions --print --output-format text "/analyze ModuleName"
```

Requires:
- Claude CLI configured with Playwright MCP server for UI analysis
- Environment variables in `.claude/settings.local.json`: `APPLICATION_URL`, `STARTUP_SCRIPT`, `credentials_email`, `credentials_password`

### State Management
- Progress tracked in `.analyze-state/` directory
- Modules marked as analyzed via `set_module_analyzed()` / `is_module_analyzed()`
- Failed modules logged to `.analyze-state/failed_modules.txt`
- Supports resume after interruption

### Output Structure
```
Documents/
├── BRD/           # Business Requirements Documents
├── FRD/           # Functional Requirements Documents
├── UserStories/   # User story documents
├── ProcessFlow/   # Process flows with diagrams/
├── Modules/       # Module docs with diagrams/
├── Security/      # Security documentation
├── Migration Notes/
└── DOCX/          # Converted Word documents
```
